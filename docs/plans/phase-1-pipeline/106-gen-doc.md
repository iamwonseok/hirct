# Task 106: gen-doc — HW 문서 생성기

> **목표**: GenDoc HW 문서 + 프로그래머 가이드 생성기 신규 작성
> **예상 시간**: 1일 (6개 Step)
> **파일**: `lib/Target/GenDoc.cpp` (신규 작성)
> **TDD**: RED → GREEN → REFACTOR

---

## 현재 상태

- Bootstrap(Task 100)에서 emitter 인프라 구축 완료. GenDoc를 신규 작성한다. HW Spec + Programmer's Guide를 단일 마크다운 파일로 생성.

---

## 출력 콘텐츠 템플릿

GenDoc가 생성하는 `doc/<module>.md`의 표준 구조:

```markdown
# <ModuleName> Hardware Documentation

> AUTO-GENERATED by hirct-gen — DO NOT EDIT

## Hardware Spec

### Port Map

| Name | Direction | Width | Description |
|------|-----------|-------|-------------|
| clock | input | 1 | System clock |
| reset | input | 1 | Active-high reset |
| io_in | input | 32 | Input data |
| io_out | output | 32 | Output data |

### Internal Signals

- Registers: N개 (seq.firreg/seq.compreg)
- Combinational ops: M개
- Instances: K개 (hw.instance)

### Register Summary (레지스터 존재 시)

| Register | Width | Reset Value | Clock |
|----------|-------|-------------|-------|

## Programmer's Guide

### Quick Start

이 모듈은 <N>비트 입력을 받아 <M>비트 출력을 생성합니다.

### Reset Sequence

1. `reset` 신호를 1로 설정
2. 1 클럭 사이클 대기
3. `reset` 신호를 0으로 해제

### C++ Model Usage

\`\`\`cpp
#include "<ModuleName>.h"
<ModuleName> model;
model.do_reset();
model.io_in = 0x1234;
model.step();
printf("output: 0x%x\n", model.io_out);
\`\`\`

## Module Hierarchy (인스턴스 존재 시)

- <ModuleName>
  - u_sub: SubModule
```

> **Note**: 위 템플릿은 최소 구조이다. 모듈의 실제 포트/레지스터/인스턴스에 따라 동적으로 생성된다.
> 레지스터가 없으면 "Register Summary" 섹션은 생략, 인스턴스가 없으면 "Module Hierarchy" 섹션은 생략된다.

---

## Step 1: 신규 작성 + 빌드 확인 (5분)

**Goal**: GenDoc.cpp 신규 작성 후 빌드 통과

**Run**:
```bash
# lib/Target/GenDoc.cpp 신규 작성, CMakeLists.txt, main.cpp에 등록
cmake --build build 2>&1 | tail -5
echo "Exit: $?"
```

**Expect**:
```
Exit: 0
```

---

## Step 2: HW Spec + Programmer's Guide 신규 작성 (20분)

**Goal**: 단일 .md 파일에 ## Hardware Spec + ## Programmer's Guide 섹션으로 출력

**Run**:
```bash
# GenDoc.cpp 신규 작성: doc/<module>.md 하나에 두 섹션
cmake --build build 2>&1 | tail -5
echo "Exit: $?"
```

**Expect**:
```
Exit: 0
```

---

## Step 3: 기존 출력 확인 (3분)

**Goal**: GenDoc 출력 기능 동작 확인

**Run**:
```bash
hirct-gen rtl/plat/src/s5/design/Fadu_K2_S5_LevelGateway.v
cat output/plat/src/s5/design/Fadu_K2_S5_LevelGateway/doc/Fadu_K2_S5_LevelGateway.md | head -20
```

> **Implementation Note**: 개발 중 개별 emitter 테스트 시 `--only` 필터 사용:
> `hirct-gen rtl/plat/src/s5/design/Fadu_K2_S5_LevelGateway.v --only doc`

**Expect**:
```
Markdown 포트 테이블 출력
```

---

## Step 4: RED — 모듈 계층 트리 확인 (3분)

**Goal**: 계층 트리가 아직 없음을 확인

**Run**:
```bash
grep -c 'hierarchy\|├\|└\|│' output/plat/src/s5/design/Fadu_K2_S5_LevelGateway/doc/Fadu_K2_S5_LevelGateway.md
```

**Expect**:
```
0 (계층 트리 없음 — RED)
```

---

## Step 5: GREEN — 모듈 계층 트리 추가 (15분)

**Goal**: hw.instance 정보가 있는 경우 계층 트리를 Markdown에 출력

**Files:**
- 수정: `lib/Target/GenDoc.cpp`

**변경 내용:**
- ModuleAnalyzer에서 인스턴스 목록 추출
- Markdown 트리 형식으로 출력:
```markdown
## Module Hierarchy

- CoreIPSubsystem
  - u_plic: PLIC
    - u_gw0: LevelGateway
    - u_fanin: PLICFanIn
```

**Run**:
```bash
cmake --build build
hirct-gen rtl/plat/src/s5/design/Fadu_K2_S5_LevelGateway.v
cat output/plat/src/s5/design/Fadu_K2_S5_LevelGateway/doc/Fadu_K2_S5_LevelGateway.md
```

> **Implementation Note**: 개발 중 개별 emitter 테스트 시 `--only` 필터 사용:
> `hirct-gen rtl/plat/src/s5/design/Fadu_K2_S5_LevelGateway.v --only doc`

**Expect**:
```
포트 테이블 + (인스턴스가 있으면) 계층 트리
```

---

## Step 6: 커밋 (3분)

**Run**:
```bash
git add lib/Target/GenDoc.cpp lib/Target/CMakeLists.txt tools/hirct-gen/main.cpp
git commit -m "feat: GenDoc emitter 신규 작성, HW Spec + Programmer's Guide + hierarchy tree"
```

---

## ModuleAnalyzer 변경 사항

**신규 구현**: `std::vector<InstanceInfo> getInstanceHierarchy() const`
- hw.instance 정보에서 인스턴스 목록/계층 트리를 추출

---

## 게이트 (완료 기준)

- [ ] `hirct-gen rtl/plat/src/s5/design/Fadu_K2_S5_LevelGateway.v` → `output/.../doc/*.md` 존재
- [ ] `[ -s output/.../doc/Fadu_K2_S5_LevelGateway.md ]` → 파일 크기 > 0
- [ ] Markdown 포트 테이블 포함 확인
- [ ] 인스턴스 있는 모듈 → 계층 트리 포함 확인
- [ ] GenDoc.cpp 신규 작성 완료
- [ ] 출력 .md에 ## Hardware Spec + ## Programmer's Guide 섹션 포함 확인
- [ ] `test/Target/GenDoc/` lit 테스트 최소 1개 PASS
